name: ⏰ Keep Render Server Alive + Gmail Alert

on:
  schedule:
    - cron: '*/5 * * * *'  # chạy mỗi 5 phút
  workflow_dispatch:       # cho phép chạy thủ công

jobs:
  ping-render:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render Server
        id: ping
        run: |
          curl -s --max-time 10 https://this-does-not-exist.com || exit 1

      - name: Send Gmail Alert if Server is Down
        if: failure()
        run: |
          echo "Subject: 🚨 Render Server Down" > email.txt
          echo "The server at https://doraemon-backend.onrender.com is not responding." >> email.txt
          msmtp --host=smtp.gmail.com --port=587 --auth=on \
            --user=vieth8101@gmail.com --from=vieth8101@gmail.com \
            --passwordeval="echo ${{ secrets.SMTP_PASS }}" \
            --tls=on vieth8101@gmail.com < email.txt
